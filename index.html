<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Request Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Segoe UI, Arial,sans-serif; margin:0; background:#f6fafd; }
    header { background:#013963; color:#fff; padding:1em 2em; }
    header h1 { margin:0; }
    .role-switch { float:right; margin-top:-2.7em; }
    .container { max-width:1080px; margin:2em auto; background:#fff; border-radius:8px; box-shadow:0 0 16px #ebebeb; padding:2em; }
    h2 { color:#0069d9; margin-top:0.1em; }
    form { margin-bottom:2em; }
    label { display:block; font-weight:bold; margin:1em 0 0.5em; }
    input[type="text"], textarea, select { width:100%; padding:0.7em; margin-bottom:0.8em; border-radius:5px; border:1px solid #bbb; }
    .split-row { display:grid; grid-template-columns:1fr 1fr; gap:1em;}
    button, .fake-link { background:#0069d9; color:#fff; border:none; border-radius:5px; padding:0.7em 1.5em; font-size:1em; cursor:pointer; }
    .actions button, .actions .fake-link {padding:0.4em 1em; font-size:0.95em;}
    button:hover, .fake-link:hover { background:#0053a3; }
    .fake-link {background:none;color:#0069d9;text-decoration:underline;cursor:pointer;border:none;}
    table { width:100%; border-collapse:collapse; margin-top:1em; }
    th, td { padding:0.65em; border-bottom:1px solid #e7e7e7; vertical-align:top;}
    th { background:#013963; color:#fff; position:sticky; top:0; z-index:1; }
    tr:hover:not(.detail-row) {background:#f1f7ff;}
    .badge { padding:2px 8px; border-radius:12px; font-size:0.9em; color:#fff;}
    .pending { background:#ffaa55; }
    .inprogress { background:#56c6ff;}
    .completed { background:#57ce90; }
    .onhold {background:#ccc016;}
    .detail-row { background:#f1f5fc !important; }
    .detail-cell { padding:1.2em 2em; font-size:1.08em; color:#222; }
    .sr-label { color:#245; font-weight: bold;}
    .commentbox {margin-top:1em; background:#fdfad7;padding:0.75em 1em;border-radius:6px;}
    .commentlog {font-size:0.97em; margin-top:0.6em;}
    .internal {background:#e3f7e3;padding:4px 7px;border-radius:4px;font-size:0.98em;}
    .extern {background:#eaf6ff;padding:4px 7px;border-radius:4px;font-size:0.98em;}
    .attachment {margin-left:0.8em;font-size:0.9em;}
    .filter-bar {margin-bottom:1em; display:flex; flex-wrap:wrap; gap:0.7em;}
    .filter-bar > * {margin:0;}
    .dash {font-size:1em; margin:1em 0 2em; display:flex; gap:2.4em;}
    .dashbox {background:#f5f6fb;padding:1em 1.5em;border-radius:5px;box-shadow:0 2px 8px #efefef;font-size:1.1em;}
    .assigned {font-size:0.93em;color:#014b70;}
    .csv-export {margin-left:1.5em;font-size:0.97em;}
    @media (max-width: 700px) {
      .container {padding:0.5em;}
      th,td {font-size:0.95em;white-space:normal;}
      .split-row {grid-template-columns:1fr;}
    }
    footer { text-align:center; color:#999; padding:1em; margin-top:2em; }

    /* Login Screen Styles */
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .login-form {
      background: white;
      padding: 2em;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      width: 400px;
    }
    .login-form input {
      width: 100%;
      padding: 0.8em;
      margin: 0.5em 0;
    }
    .login-form button {
      width: 100%;
      padding: 0.8em;
      background: #013963;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .login-form button:hover {
      background: #0053a3;
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-form">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="username" placeholder="Jason" required>
        <input type="password" id="password" placeholder="test" required>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

  <header>
    <h1>Work Request Portal</h1>
    <div class="role-switch">
      <label for="roleSelect" style="font-weight:normal;">View as: </label>
      <select id="roleSelect">
        <option value="staff">Staff</option>
        <option value="sys">Systems Team</option>
        <option value="admin">Admin</option>
      </select>
    </div>
  </header>
  <div class="container" id="container">
    <div class="dash" id="dashboard"></div>

    <div id="staffFormSection">
      <h2>Submit New Request</h2>
      <form id="requestForm">
        <div class="split-row">
          <div>
            <label for="reqRequester">Your Name</label>
            <input type="text" id="reqRequester" required>
          </div>
          <div>
            <label for="reqCategory">Category</label>
            <select id="reqCategory">
              <option>General</option>
              <option>Payroll</option>
              <option>Benefits</option>
              <option>Recruiting</option>
              <option>Onboarding</option>
              <option>Training/Learning</option>
              <option>System Access</option>
              <option>Reporting</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <label for="reqTitle">Title</label>
        <input type="text" id="reqTitle" required>
        <label for="reqDesc">Description</label>
        <textarea id="reqDesc" rows="2" required></textarea>
        <div class="split-row">
          <div>
            <label for="reqPriority">Priority</label>
            <select id="reqPriority">
              <option>Medium</option>
              <option>Low</option>
              <option>High</option>
              <option>Critical</option>
            </select>
          </div>
          <div>
            <label for="reqAttachment">Attachment (link or filename, optional)</label>
            <input type="text" id="reqAttachment" placeholder="Paste URL or filename">
          </div>
        </div>
        <button type="submit">Submit Request</button>
      </form>
    </div>

    <div class="filter-bar" id="filterBar"></div>

    <h2>Work Requests</h2>
    <table id="requestsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title / Category</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Requester</th>
          <th>Created</th>
          <th>Assigned</th>
        </tr>
      </thead>
      <tbody>
        <!-- Requests go here -->
      </tbody>
    </table>
    <div class="csv-export">
      <button onclick="exportCSV()">Export CSV</button>
    </div>
  </div>
  <footer>
    &copy; 2025 Work Request Portal
  </footer>

  <script>
    // Define allowed users with their roles and passwords
    const allowedUsers = {
      'Jason': { password: 'test', role: 'staff' },
      'sysadmin123': { password: 'sysadmin123', role: 'sys' },
      'admin123': { password: 'admin123', role: 'admin' }
    };

    let loggedInUser = null;
    let requests = JSON.parse(localStorage.getItem('requests_2') || '[]');
    let nextId = requests.length ? Math.max(...requests.map(r => r.id)) + 1 : 1;
    let openedDetailId = null;
    let userRole = 'guest'; // Default role with no access
    let userName = "";
    let filterStatus = "";
    let filterMyTickets = false;
    let filterCategory = "";

    const ROLE_OPTIONS = {
      "staff": "Staff",
      "sys": "Systems Team",
      "admin": "Admin"
    };

    function $(id) { return document.getElementById(id); }

    // Check if user is logged in
    function checkLogin() {
      if (!loggedInUser) {
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('container').style.display = 'none';
      } else {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('container').style.display = 'block';
      }
    }

    // Handle login form submission
    document.getElementById('loginForm').addEventListener('submit', function(e) {
