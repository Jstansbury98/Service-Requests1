<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Request Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial,sans-serif; margin:0; background:#f6fafd; }
    header { background:#013963; color:#fff; padding:1em 2em; }
    header h1 { margin:0; }
    .container { max-width:900px; margin:2em auto; background:#fff; border-radius:8px; box-shadow:0 0 12px #eee; padding:2em; }
    h2 { color:#0069d9; margin-top:0; }
    form { margin-bottom:2em; }
    label { display:block; font-weight:bold; margin:1em 0 0.5em; }
    input, textarea, select { width:100%; padding:0.7em; margin-bottom:0.8em; border-radius:5px; border:1px solid #bbb; }
    button { background:#0069d9; color:#fff; border:none; border-radius:5px; padding:0.7em 1.5em; font-size:1em; cursor:pointer; }
    button:hover { background:#0053a3; }
    table { width:100%; border-collapse:collapse; margin-top:1em; }
    th, td { padding:0.7em; border-bottom:1px solid #e7e7e7; }
    th { background:#013963; color:#fff; }
    tr:hover {background:#f1f7ff;}
    .badge { padding:2px 8px; border-radius:12px; font-size:0.9em; }
    .pending { background:#ffea91; color:#856a00; }
    .inprogress { background:#bfecff; color:#0081a6;}
    .completed { background:#c7fdb8; color:#287501; }
    .detail-row { background:#f1f5fc !important; }
    .detail-cell { padding:1em 2em; font-size:1.08em; color:#222; }
    .sr-label { color: #013963; font-weight: bold;}
    .actions button {margin-right: 0.5em;}
    @media (max-width: 700px) {
      .container {padding:0.5em;}
      th,td {font-size:0.95em;}
    }
    footer { text-align:center; color:#999; padding:1em; margin-top:2em; }
  </style>
</head>
<body>
  <header>
    <h1>Work Request Portal</h1>
  </header>
  <div class="container">
    <h2>Submit New Request</h2>
    <form id="requestForm">
      <label for="reqRequester">Your Name</label>
      <input type="text" id="reqRequester" required>
      <label for="reqTitle">Title</label>
      <input type="text" id="reqTitle" required>
      <label for="reqDesc">Description</label>
      <textarea id="reqDesc" rows="2" required></textarea>
      <label for="reqPriority">Priority</label>
      <select id="reqPriority">
        <option>Medium</option>
        <option>Low</option>
        <option>High</option>
      </select>
      <button type="submit">Submit Request</button>
    </form>
    <h2>All Work Requests</h2>
    <table id="requestsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Requester</th>
          <th>Submitted At</th>
        </tr>
      </thead>
      <tbody>
        <!-- Requests and detail rows appear here -->
      </tbody>
    </table>
  </div>
  <footer>
    &copy; 2025 Work Request Portal
  </footer>
  <script>
    let requests = JSON.parse(localStorage.getItem('requests') || '[]');
    let nextId = requests.length ? Math.max(...requests.map(r => r.id))+1 : 1;
    let openedDetailId = null;

    function getStatusBadge(status) {
      let statusClass='';
      switch (status) {
        case 'Pending': statusClass = 'pending'; break;
        case 'In Progress': statusClass = 'inprogress'; break;
        case 'Completed': statusClass = 'completed'; break;
        default: statusClass = '';
      }
      return `<span class="badge ${statusClass}">${status}</span>`;
    }

    function renderRequests() {
      const tbody = document.querySelector('#requestsTable tbody');
      tbody.innerHTML = '';
      requests.sort((a,b)=>b.id-a.id).forEach(req => {
        tbody.innerHTML += `
        <tr style="cursor:pointer;" onclick="toggleDetail(${req.id})">
          <td>${req.id}</td>
          <td>${req.title}</td>
          <td>${getStatusBadge(req.status)}</td>
          <td>${req.priority}</td>
          <td>${req.requester}</td>
          <td>${req.createdAt ? formatDT(req.createdAt) : ''}</td>
        </tr>
        ${
          openedDetailId === req.id ? `
          <tr class="detail-row">
            <td class="detail-cell" colspan="6">
              <div><span class="sr-label">Description:</span><br>${req.description}</div>
              <div style="margin-top:0.6em;"><span class="sr-label">Update Status: </span>
                <span class="actions">
                  ${req.status !== 'In Progress' ? `<button onclick="setStatus(${req.id},'In Progress');event.stopPropagation();">Start</button>`:''}
                  ${req.status !== 'Completed' ? `<button onclick="setStatus(${req.id},'Completed');event.stopPropagation();">Complete</button>`:''}
                  ${req.status !== 'Pending' ? `<button onclick="setStatus(${req.id},'Pending');event.stopPropagation();">Revert to Pending</button>`:''}
                  <button onclick="deleteReq(${req.id});event.stopPropagation();">Delete</button>
                </span>
              </div>
            </td>
          </tr>
          `:''
        }
        `;
      });
    }

    function formatDT(dt){
      const d = new Date(dt);
      return d.toLocaleString();
    }

    document.getElementById('requestForm').onsubmit = function(e){
      e.preventDefault();
      let req = {
        id: nextId++,
        title: reqTitle.value,
        description: reqDesc.value,
        status: 'Pending',
        priority: reqPriority.value,
        requester: reqRequester.value,
        createdAt: new Date().toISOString()
      }
      requests.push(req);
      localStorage.setItem('requests', JSON.stringify(requests));
      openedDetailId = req.id;
      renderRequests();
      this.reset();
    };

    function toggleDetail(id) {
      openedDetailId = (openedDetailId === id ? null : id);
      renderRequests();
    }
    function setStatus(id,status){
      for(let r of requests) if(r.id===id) r.status=status;
      localStorage.setItem('requests', JSON.stringify(requests));
      renderRequests();
    }
    function deleteReq(id){
      if(confirm('Delete this request?')){
        requests = requests.filter(r=>r.id!==id);
        localStorage.setItem('requests', JSON.stringify(requests));
        openedDetailId = null;
        renderRequests();
      }
    }

    // Expose for inline html
    window.toggleDetail = toggleDetail;
    window.setStatus = setStatus;
    window.deleteReq = deleteReq;

    renderRequests();
  </script>
</body>
</html>

